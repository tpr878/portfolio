{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravi Rastogi | AI Agent Portfolio</title>
    <meta name="description"
        content="Interactive AI-powered portfolio of Ravi Rastogi - AI/ML Researcher & Full-Stack Developer specializing in NLP, Climate Research, and Data Science.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* Dark Mode (Default) - Coding/AI Theme */
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --accent-primary: #00d9ff;
            --accent-secondary: #a855f7;
            --accent-gradient: linear-gradient(135deg, #00d9ff 0%, #a855f7 100%);
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border-color: #30363d;
            --accent-glow: rgba(168, 85, 247, 0.3);
        }

        /* Light Mode */
        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f6f8fa;
            --bg-tertiary: #eaeef2;
            --accent-primary: #0969da;
            --accent-secondary: #8b5cf6;
            --accent-gradient: linear-gradient(135deg, #0969da 0%, #8b5cf6 100%);
            --text-primary: #1f2328;
            --text-secondary: #59636e;
            --text-muted: #88929d;
            --border-color: #d1d9e0;
            --accent-glow: rgba(139, 92, 246, 0.2);
        }

        * {
            box-sizing: border-box;
            transition: background-color 0.3s, border-color 0.3s, color 0.2s;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Terminal-style gradient background */
        .gradient-bg {
            background: var(--bg-primary);
            position: fixed;
            inset: 0;
            z-index: -1;
        }

        .gradient-bg::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at 20% 20%, rgba(0, 217, 255, 0.08) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 255, 136, 0.06) 0%, transparent 40%);
            animation: pulse 10s ease-in-out infinite;
        }

        [data-theme="light"] .gradient-bg::before {
            background: radial-gradient(ellipse at 20% 20%, rgba(9, 105, 218, 0.06) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 80%, rgba(26, 127, 55, 0.04) 0%, transparent 40%);
        }

        /* Code grid pattern */
        .gradient-bg::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(0, 217, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 217, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        [data-theme="light"] .gradient-bg::after {
            background-image:
                linear-gradient(rgba(9, 105, 218, 0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(9, 105, 218, 0.04) 1px, transparent 1px);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        /* Chat container */
        .chat-container {
            max-width: 900px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            background: rgba(13, 17, 23, 0.9);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        [data-theme="light"] .header {
            background: rgba(255, 255, 255, 0.9);
        }

        /* Theme Toggle Button */
        .theme-toggle {
            width: 44px;
            height: 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            position: relative;
        }

        .theme-toggle::after {
            content: 'üåô';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: left 0.3s;
        }

        [data-theme="light"] .theme-toggle::after {
            content: '‚òÄÔ∏è';
            left: calc(100% - 20px);
        }

        .header-title {
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Messages area */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem 1rem;
            scroll-behavior: smooth;
        }

        .messages-area::-webkit-scrollbar {
            width: 6px;
        }

        .messages-area::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .messages-area::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        /* Message bubbles */
        .message {
            margin-bottom: 1rem;
            animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .message-agent {
            display: flex;
            gap: 0.75rem;
        }

        .message-user {
            display: flex;
            justify-content: flex-end;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .bubble {
            padding: 1rem 1.25rem;
            border-radius: 16px;
            max-width: 80%;
        }

        .bubble-agent {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px 16px 16px 4px;
        }

        .bubble-user {
            background: var(--accent-gradient);
            border-radius: 16px 16px 4px 16px;
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 1rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0.6);
                opacity: 0.4;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Prompt chips */
        .chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .chip {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .chip:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* Input area */
        .input-area {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            background: rgba(13, 17, 23, 0.95);
        }

        [data-theme="light"] .input-area {
            background: rgba(255, 255, 255, 0.95);
        }

        .input-wrapper {
            display: flex;
            gap: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 0.75rem 1rem;
            transition: border-color 0.2s;
        }

        .input-wrapper:focus-within {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-field {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .input-field::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--accent-gradient);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Response cards */
        .response-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.25rem;
            margin-top: 0.75rem;
            transition: border-color 0.2s;
        }

        .response-card:hover {
            border-color: var(--accent-primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .card-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .card-subtitle {
            font-size: 0.875rem;
            color: var(--accent-secondary);
            margin-top: 0.25rem;
        }

        .card-date {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
        }

        .card-content {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .tech-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tech-tag {
            padding: 0.25rem 0.75rem;
            background: rgba(99, 102, 241, 0.15);
            color: #a5b4fc;
            border-radius: 6px;
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Category icon */
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            margin-right: 0.75rem;
        }

        .category-education {
            background: rgba(34, 197, 94, 0.2);
        }

        .category-experience {
            background: rgba(59, 130, 246, 0.2);
        }

        .category-project {
            background: rgba(168, 85, 247, 0.2);
        }

        .category-skill {
            background: rgba(251, 146, 60, 0.2);
        }

        .category-publication {
            background: rgba(236, 72, 153, 0.2);
        }

        .category-profile {
            background: rgba(99, 102, 241, 0.2);
        }

        /* Social Links */
        .social-links {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .social-link {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
        }

        .social-link:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: #0d1117;
            transform: translateY(-2px);
        }

        [data-theme="light"] .social-link:hover {
            color: #ffffff;
        }

        .profile-photo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
            color: #0d1117;
            border: 2px solid var(--accent-primary);
            overflow: hidden;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }

        /* Photo Modal/Lightbox */
        .photo-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            animation: fadeIn 0.3s ease;
        }

        .photo-modal.active {
            display: flex;
        }

        .photo-modal img {
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: zoomIn 0.3s ease;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 48px;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s, transform 0.2s;
            z-index: 1001;
        }

        .modal-close:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }

            .chat-container {
                height: auto;
                min-height: 100vh;
            }

            .messages-area {
                height: auto;
                overflow: visible;
            }

            .header-content {
                flex-direction: column;
                gap: 0.75rem;
            }

            .header-left {
                width: 100%;
                justify-content: center;
                flex-direction: column;
                /* Stack image and text */
                text-align: center;
            }

            .header-right {
                width: 100%;
                justify-content: center;
                gap: 0.75rem;
            }

            .profile-photo {
                width: 140px;
                /* Even bigger image */
                height: 140px;
                margin-bottom: 0.75rem;
                border-radius: 24px;
                /* Add spacing below image */
            }

            .header-title {
                font-size: 1rem;
            }

            .social-links {
                gap: 0.35rem;
            }

            .social-link {
                width: 28px;
                height: 28px;
            }

            .social-link svg {
                width: 14px;
                height: 14px;
            }

            .theme-toggle {
                width: 36px;
                height: 20px;
            }

            .theme-toggle::after {
                width: 16px;
                height: 16px;
                font-size: 8px;
            }

            [data-theme="light"] .theme-toggle::after {
                left: calc(100% - 18px);
            }

            .messages-area {
                padding: 1rem 0.75rem;
            }

            .bubble {
                max-width: 90%;
                padding: 0.75rem 1rem;
            }

            .input-area {
                padding: 0.75rem;
            }

            .input-wrapper {
                padding: 0.5rem 0.75rem;
                border-radius: 12px;
            }

            .input-field {
                font-size: 16px;
                /* prevent iOS zoom */
            }

            .send-btn {
                width: 36px;
                height: 36px;
            }

            .response-card {
                padding: 1rem;
            }

            .card-title {
                font-size: 1rem;
            }

            .chip {
                padding: 0.4rem 0.75rem;
                font-size: 0.8rem;
            }

            .modal-close {
                top: 15px;
                right: 15px;
                font-size: 36px;
            }
        }

        /* Extra small screens */
        @media (max-width: 400px) {
            .header-title {
                font-size: 0.9rem;
            }

            .social-link {
                width: 26px;
                height: 26px;
            }

            .input-field::placeholder {
                font-size: 0.75rem;
            }
        }
    </style>
</head>

<body>
    <div class="gradient-bg"></div>

    <!-- Photo Modal -->
    <div class="photo-modal" id="photoModal" onclick="closePhotoModal()">
        <button class="modal-close" onclick="closePhotoModal()">&times;</button>
        <img src="{% static 'images/profile.png' %}" alt="Ravi Rastogi">
    </div>

    <div class="chat-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="profile-photo" onclick="openPhotoModal()">
                        <img src="{% static 'images/profile.png' %}" alt="Ravi Rastogi">
                    </div>
                    <div>
                        <h1 class="header-title text-xl font-bold font-mono">Ravi Rastogi</h1>
                        <p class="text-xs" style="color: var(--text-muted);">AI/ML Researcher ‚Ä¢ Full-Stack Developer</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="social-links">
                        <a href="https://www.linkedin.com/in/ravi-rastogi-02a32818b/" target="_blank"
                            class="social-link" title="LinkedIn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                            </svg>
                        </a>
                        <a href="https://github.com/tpr878" target="_blank" class="social-link" title="GitHub">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z" />
                            </svg>
                        </a>
                        <a href="mailto:itsravirastogi@gmail.com" class="social-link" title="Email">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
                            </svg>
                        </a>
                        <a href="tel:+353899564137" class="social-link" title="Call">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z" />
                            </svg>
                        </a>
                    </div>
                    <button class="theme-toggle" id="themeToggle" title="Toggle Light/Dark Mode"></button>
                </div>
            </div>
        </header>

        <!-- Messages Area -->
        <main class="messages-area" id="messagesArea">
            <!-- Initial greeting will be inserted here -->
        </main>

        <!-- Input Area -->
        <footer class="input-area">
            <div class="input-wrapper">
                <input type="text" class="input-field" id="messageInput"
                    placeholder="Ask about skills, projects... or simply 'Can he code'" autocomplete="off">
                <button class="send-btn" id="sendBtn" aria-label="Send message">
                    <svg width="20" height="20" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                    </svg>
                </button>
            </div>
        </footer>
    </div>

    <script>
        // Photo Modal Functions
        const photoModal = document.getElementById('photoModal');

        function openPhotoModal() {
            photoModal.classList.add('active');
        }

        function closePhotoModal() {
            photoModal.classList.remove('active');
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closePhotoModal();
        });

        // Theme Toggle Functionality
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Check for saved theme preference or default to dark
        const savedTheme = localStorage.getItem('theme') || 'dark';
        if (savedTheme === 'light') {
            html.setAttribute('data-theme', 'light');
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            if (newTheme === 'light') {
                html.setAttribute('data-theme', 'light');
            } else {
                html.removeAttribute('data-theme');
            }

            localStorage.setItem('theme', newTheme);
        });

        const messagesArea = document.getElementById('messagesArea');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');

        // Track user interactions and scroll state
        let hasClicked = false;
        let currentRevealIndex = -1; // -1 means greeting shown, 0+ means sections
        let isRevealing = false;
        let scrollCooldown = false;
        let initialScrollCount = 0;

        // Categories to reveal in order (one per scroll)
        const revealSequence = [
            { query: 'about', intro: "üë§ Let me tell you about Ravi..." },
            { query: 'education', intro: "üéì Here's his educational background..." },
            { query: 'experience', intro: "üíº His professional experience..." },
            { query: 'projects', intro: "üìÇ Check out his projects..." },
            { query: 'skills', intro: "üî¨ Technologies he works with..." },
            { query: 'publications', intro: "üìÑ His published research..." }
        ];

        // Category icons
        const categoryIcons = {
            'education': 'üéì',
            'experience': 'üíº',
            'project': 'üìÇ',
            'skill': 'üî¨',
            'publication': 'üìÑ',
            'profile': 'üë§'
        };

        // Initial greeting
        const greeting = `
            <p class="mb-4">Hello! I am <strong>Ravi's Personal Agent</strong>. üëã</p>
            <p class="text-gray-400 mb-4">I can tell you about his research in Climate Migration, his NLP work, or his operational experience. What would you like to know?</p>
            <div class="chips-container">
                <button class="chip" data-query="projects">üìÇ Projects</button>
                <button class="chip" data-query="education">üéì Education</button>
                <button class="chip" data-query="experience">üíº Experience</button>
                <button class="chip" data-query="skills">üî¨ Skills</button>
                <button class="chip" data-query="publications">üìÑ Publications</button>
            </div>
            <p class="text-gray-500 text-sm mt-4 italic">üí° Tip: Just scroll to explore everything!</p>
        `;

        // Add agent message
        function addAgentMessage(content, isHTML = false, doScroll = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message message-agent';
            messageDiv.innerHTML = `
                <div class="avatar">R</div>
                <div class="bubble bubble-agent">
                    ${isHTML ? content : `<p>${content}</p>`}
                </div>
            `;
            messagesArea.appendChild(messageDiv);
            if (doScroll) scrollToBottom();
        }

        // Add user message
        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message message-user';
            messageDiv.innerHTML = `
                <div class="bubble bubble-user">
                    <p>${text}</p>
                </div>
            `;
            messagesArea.appendChild(messageDiv);
            scrollToBottom();
        }

        // Add typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message message-agent';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="avatar">R</div>
                <div class="bubble bubble-agent">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesArea.appendChild(typingDiv);
            scrollToBottom();
        }

        function removeTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        function scrollToBottom() {
            // Check if mobile layout (body scroll)
            if (window.innerWidth <= 768) {
                window.scrollTo({
                    top: document.documentElement.scrollHeight,
                    behavior: 'smooth'
                });
            } else {
                messagesArea.scrollTo({
                    top: messagesArea.scrollHeight,
                    behavior: 'smooth'
                });
            }
        }

        // Fetch category data
        async function fetchCategoryData(query) {
            try {
                const response = await fetch(`/api/chat/?message=${encodeURIComponent(query)}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching:', error);
                return null;
            }
        }

        // Reveal next section on scroll
        async function revealNextSection() {
            if (isRevealing || hasClicked) return;
            if (currentRevealIndex >= revealSequence.length - 1) return; // All revealed

            isRevealing = true;
            currentRevealIndex++;

            const section = revealSequence[currentRevealIndex];

            // Show "scrolling without clicking" message on first scroll-trigger
            if (currentRevealIndex === 0) {
                addAgentMessage(`
                    <p class="mb-2">üëÄ <strong>I see you're scrolling!</strong></p>
                    <p class="text-gray-400">Let me show you everything Ravi has to offer...</p>
                `, true, false); // No auto-scroll
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            // Show intro for this section
            addAgentMessage(`<p class="text-purple-400">${section.intro}</p>`, true, false); // No auto-scroll

            showTypingIndicator(); // typing indicator scrolls
            await new Promise(resolve => setTimeout(resolve, 300)); // Faster reveal

            const data = await fetchCategoryData(section.query);
            removeTypingIndicator();

            if (data && data.success) {
                addAgentMessage(data.html, true, false); // No auto-scroll
            }

            // Add subtle hint if not the last section (no buttons for auto-scroll)
            if (currentRevealIndex < revealSequence.length - 1) {
                await new Promise(resolve => setTimeout(resolve, 500));
                addAgentMessage('<p class="text-sm text-gray-400">‚¨áÔ∏è Keep scrolling for more...</p>', true, false);
            }

            // Show completion message after last section
            if (currentRevealIndex === revealSequence.length - 1) {
                await new Promise(resolve => setTimeout(resolve, 500));
                addAgentMessage(`
                    <p class="mb-3">‚ú® <strong>That's the complete tour!</strong></p>
                    <p class="text-gray-400">If you have any specific questions, feel free to ask in the chat below.</p>
                `, true, false); // No auto-scroll
            }

            isRevealing = false;
        }

        // Scroll detection with cooldown - ONLY triggers on intentional scroll DOWN
        function handleScroll(e) {
            if (hasClicked || isRevealing || scrollCooldown) return;
            if (currentRevealIndex >= revealSequence.length - 1) return;

            // Check scroll direction and magnitude - only trigger on significant scroll DOWN
            if (e && e.type === 'wheel') {
                // Require a minimum scroll delta to avoid accidental triggers
                if (e.deltaY < 50) return;
            }
            // Also allow undefined 'e' (from touch handler)
            else if (e !== undefined) {
                return;
            }

            // Trigger when user is getting close to bottom (within 300px)
            // This creates a smoother "infinite scroll" feel
            const scrollPosition = window.innerHeight + window.scrollY;
            const documentHeight = document.documentElement.scrollHeight;

            if (documentHeight - scrollPosition > 300) return;

            // Count initial intentional scrolls before activating
            initialScrollCount++;
            if (initialScrollCount < 3) return; // Require 3 intentional down-scrolls to start

            // Set cooldown - faster for first scroll, slower for rest
            scrollCooldown = true;
            const cooldownTime = currentRevealIndex === -1 ? 500 : 1000;
            setTimeout(() => { scrollCooldown = false; }, cooldownTime);

            revealNextSection();
        }

        // Send message (for clicks/typing)
        async function sendMessage(query) {
            if (!query.trim()) return;

            addUserMessage(query);
            messageInput.value = '';
            sendBtn.disabled = true;

            showTypingIndicator();
            await new Promise(resolve => setTimeout(resolve, 600 + Math.random() * 200));

            try {
                const response = await fetch(`/api/chat/?message=${encodeURIComponent(query)}`);
                const data = await response.json();

                removeTypingIndicator();

                if (data.success) {
                    addAgentMessage(data.html, true);

                    // If the query matches one of our sequence items, sync the scroll state!
                    const lowerQuery = query.toLowerCase();
                    const sequenceIndex = revealSequence.findIndex(item => lowerQuery.includes(item.query));

                    if (sequenceIndex !== -1) {
                        currentRevealIndex = sequenceIndex;
                        hasClicked = false; // Re-enable scroll reveal!
                        initialScrollCount = 10; // Bypass initial scroll count check to allow immediate scrolling
                        scrollCooldown = false; // Reset cooldown to allow immediate scrolling

                        // Add navigation buttons for upcoming sections
                        if (currentRevealIndex < revealSequence.length - 1) {
                            setTimeout(() => {
                                const upcomingSections = revealSequence.slice(currentRevealIndex + 1, currentRevealIndex + 4);
                                const buttonChips = upcomingSections.map(section =>
                                    `<button class="chip" data-query="${section.query}">${section.intro.split(' ')[0]} ${section.query.charAt(0).toUpperCase() + section.query.slice(1)}</button>`
                                ).join('');

                                addAgentMessage(`
                                    <div class="chips-container">${buttonChips}</div>
                                `, true, false);
                            }, 1000);
                        }
                    }
                } else {
                    addAgentMessage("I'm sorry, I didn't understand that. Try clicking one of the topic buttons or ask about my skills, projects, or experience.");
                }
            } catch (error) {
                removeTypingIndicator();
                addAgentMessage("Oops! Something went wrong. Please try again.");
                console.error('Error:', error);
            }

            sendBtn.disabled = false;
            messageInput.focus();
        }

        // Event listeners
        sendBtn.addEventListener('click', () => {
            hasClicked = true;
            sendMessage(messageInput.value);
        });

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                hasClicked = true;
                sendMessage(messageInput.value);
            }
        });

        messageInput.addEventListener('focus', () => {
            hasClicked = true;
        });

        // Chip click handler
        messagesArea.addEventListener('click', (e) => {
            if (e.target.classList.contains('chip')) {
                const query = e.target.dataset.query;

                // Only set hasClicked if this is NOT a sequence query
                // This allows the scroll tour to continue after clicking sequence items
                const isSequenceQuery = revealSequence.some(item => query.toLowerCase().includes(item.query));
                if (!isSequenceQuery) {
                    hasClicked = true;
                }

                sendMessage(query);
            }
        });

        // Wheel listener for progressive reveal (only wheel, not scroll)
        document.addEventListener('wheel', handleScroll, { passive: true });

        // Touch support for mobile
        let touchStartY = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        });
        document.addEventListener('touchmove', (e) => {
            const touchDiff = touchStartY - e.touches[0].clientY;
            if (touchDiff > 50) { // Scrolled down
                handleScroll();
                touchStartY = e.touches[0].clientY;
            }
        });

        // Initialize with greeting
        window.addEventListener('DOMContentLoaded', () => {
            addAgentMessage(greeting, true);
        });
    </script>
</body>

</html>